<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>English Magic - Pro</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        body { 
            touch-action: manipulation; 
            margin: 0; 
            padding: 0; 
            overflow-x: hidden;
            width: 100vw;
            font-family: system-ui, -apple-system, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        [dir="ltr"], .english-text {
            font-family: 'Comic Neue', cursive !important;
            letter-spacing: 0.02em;
        }

        html, #root { height: 100%; }

        .perspective { perspective: 1000px; }
        .preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }
        .animate-shake { animation: shake 0.2s ease-in-out 0s 2; }
        
        @keyframes bounce-slow {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        .animate-bounce-slow { animation: bounce-slow 1.2s infinite ease-in-out; }

        .btn-pushable {
            transition: transform 0.1s, box-shadow 0.1s;
            border-bottom-width: 6px;
        }
        .btn-pushable:active {
            border-bottom-width: 2px;
            transform: translateY(4px);
        }

        .grid-4-row {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            background: #2563eb;
            padding: 10px;
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3), inset 0 4px 6px rgba(0,0,0,0.2);
            position: relative;
        }
        .cell-4-row {
            aspect-ratio: 1;
            border-radius: 50%;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
            transition: background-color 0.15s ease;
        }

        /* Animation for the falling effect inside the cells */
        .cell-active-red { background-color: #ef4444 !important; box-shadow: 0 0 15px #ef4444; }
        .cell-active-yellow { background-color: #eab308 !important; box-shadow: 0 0 15px #eab308; }
    </style>
</head>
<body class="bg-sky-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const speak = (text) => {
            if (!window.speechSynthesis) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        };

        const Icons = {
            Volume: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M11 5L6 9H2v6h4l5 4V5z"></path><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>,
            Moon: () => <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>,
            Sun: () => (
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
                    <circle cx="12" cy="12" r="4"></circle>
                    <line x1="12" y1="2" x2="12" y2="4"></line>
                    <line x1="12" y1="20" x2="12" y2="22"></line>
                    <line x1="2" y1="12" x2="4" y2="12"></line>
                    <line x1="20" y1="12" x2="22" y2="12"></line>
                    <line x1="4.93" y1="4.93" x2="6.34" y2="6.34"></line>
                    <line x1="17.66" y1="17.66" x2="19.07" y2="19.07"></line>
                    <line x1="4.93" y1="19.07" x2="6.34" y2="17.66"></line>
                    <line x1="17.66" y1="6.34" x2="19.07" y2="4.93"></line>
                </svg>
            ),
            Back: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>,
            ArrowDown: ({ color = "currentColor" }) => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="4" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>,
            Trophy: () => <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55.47.98.97 1.21C11.47 18.44 12 19 12 19s.53-.56 1.03-.79c.5-.23.97-.66.97-1.21v-2.34"></path><path d="M12 15c-3.33 0-6-2.67-6-6V3h12v6c0 3.33-2.67 6-6 6Z"></path></svg>
        };

        const fireConfetti = () => {
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#2563eb', '#fbbf24', '#ef4444', '#10b981']
            });
        };

        // --- Memory Game ---
        const MemoryGame = ({ words, onBack, isDark }) => {
            const [cards, setCards] = useState([]);
            const [flipped, setFlipped] = useState([]);
            const [solved, setSolved] = useState([]);
            const [attempts, setAttempts] = useState(0);

            useEffect(() => {
                const gameCards = [
                    ...words.map(w => ({ id: w.id + '-eng', val: w.eng, type: 'eng', match: w.id })),
                    ...words.map(w => ({ id: w.id + '-heb', val: w.heb, type: 'heb', match: w.id }))
                ].sort(() => 0.5 - Math.random());
                setCards(gameCards);
            }, [words]);

            const handleClick = (card) => {
                if (flipped.length === 2 || solved.includes(card.id) || flipped.includes(card.id)) return;
                const newFlipped = [...flipped, card.id];
                setFlipped(newFlipped);
                if (card.type === 'eng') speak(card.val);

                if (newFlipped.length === 2) {
                    setAttempts(a => a + 1);
                    const [c1, c2] = newFlipped.map(id => cards.find(c => c.id === id));
                    if (c1.match === c2.match) {
                        setSolved(s => [...s, c1.id, c2.id]);
                        setFlipped([]);
                        if (solved.length + 2 === cards.length) fireConfetti();
                    } else {
                        setTimeout(() => setFlipped([]), 1000);
                    }
                }
            };

            return (
                <div className="flex flex-col items-center w-full max-w-md mx-auto px-2">
                    <div className="flex justify-between items-center w-full mb-4 px-4">
                        <h2 className="text-xl font-black">××©×—×§ ×”×–×™×›×¨×•×Ÿ</h2>
                        <span className="font-bold opacity-50 text-sm">××”×œ×›×™×: {attempts}</span>
                        <button onClick={onBack} className="text-sky-500 font-bold p-1"><Icons.Back /></button>
                    </div>
                    <div className="grid grid-cols-4 gap-2 w-full">
                        {cards.map(card => {
                            const isVisible = flipped.includes(card.id) || solved.includes(card.id);
                            return (
                                <div key={card.id} onClick={() => handleClick(card)} 
                                    className={`aspect-square rounded-xl cursor-pointer flex flex-col items-center justify-center text-center p-1 text-sm font-bold transition-all duration-300 border-2
                                    ${isVisible ? (isDark ? 'bg-slate-800 border-sky-500 text-white' : 'bg-white border-sky-400 text-slate-800') : 'bg-sky-500 border-sky-600'}`}>
                                    {isVisible ? card.val : <span className="text-[10px] opacity-70">×œ×—×¦×•<br/>×œ×¡×•×‘×‘</span>}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        // --- Exam ---
        const Exam = ({ words, onPass, isDark }) => {
            const [idx, setIdx] = useState(0);
            const [options, setOptions] = useState([]);
            const [status, setStatus] = useState(null); 
            const current = words[idx];

            useEffect(() => {
                if (current) {
                    const others = words.filter(w => w.id !== current.id).sort(() => 0.5 - Math.random()).slice(0, 3);
                    setOptions([...others, current].sort(() => 0.5 - Math.random()));
                }
            }, [idx]);

            const handleChoice = (word) => {
                if (status) return;
                if (word.id === current.id) {
                    setStatus('correct');
                    speak(current.eng);
                    setTimeout(() => {
                        if (idx + 1 < words.length) { setIdx(idx + 1); setStatus(null); }
                        else { onPass(); }
                    }, 800);
                } else {
                    setStatus('wrong');
                    setTimeout(() => setStatus(null), 800);
                }
            };

            return (
                <div className="flex flex-col items-center space-y-6 w-full max-w-md mx-auto px-4">
                    <div className="text-center">
                        <h2 className="text-2xl font-black text-sky-600">×‘×—×™× ×ª ××¢×‘×¨ ×œ××©×—×§×™×</h2>
                        <p className="opacity-50 font-bold tracking-widest">{idx + 1} / {words.length}</p>
                    </div>
                    <div className={`w-full p-6 rounded-3xl text-center border-4 shadow-lg max-w-[320px] ${isDark ? 'bg-slate-900 border-slate-800' : 'bg-white border-sky-100'}`}>
                        <span className="text-[10px] uppercase font-black opacity-30 block mb-1">×ª×¨×’× ×œ×× ×’×œ×™×ª:</span>
                        <h3 className={`text-3xl font-black ${isDark ? 'text-sky-400' : 'text-slate-800'}`}>{current.heb}</h3>
                    </div>
                    <div className="grid grid-cols-1 gap-3 w-full">
                        {options.map(opt => (
                            <div key={opt.id} className="relative group">
                                <button onClick={() => handleChoice(opt)}
                                    className={`english-text w-full p-4 rounded-2xl font-black text-2xl border-b-4 transition-all ${
                                        status === 'correct' && opt.id === current.id ? 'bg-green-500 text-white border-green-700' :
                                        status === 'wrong' && opt.id !== current.id ? 'bg-red-100 text-red-800 border-red-200' :
                                        (isDark ? 'bg-slate-800 border-slate-900 text-white hover:bg-slate-700' : 'bg-white border-slate-200 text-slate-700 hover:bg-sky-50')
                                    }`}>
                                    {opt.eng}
                                </button>
                                <button 
                                    onClick={(e) => { e.stopPropagation(); speak(opt.eng); }}
                                    className="absolute left-3 top-1/2 -translate-y-1/2 p-2 text-sky-400 hover:text-sky-600"
                                >
                                    <Icons.Volume size={20} />
                                </button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- GAME: Connect 4 ---
        const Connect4Game = ({ words, onBack, isDark }) => {
            const [mode, setMode] = useState(null); 
            const [board, setBoard] = useState(Array(6).fill(null).map(() => Array(7).fill(null)));
            const [currentPlayer, setCurrentPlayer] = useState(1); 
            const [gameState, setGameState] = useState('question'); 
            const [question, setQuestion] = useState(null);
            const [options, setOptions] = useState([]);
            const [winner, setWinner] = useState(null);
            const [animCell, setAnimCell] = useState(null); // {row, col, player}

            useEffect(() => {
                if (winner) fireConfetti();
            }, [winner]);

            useEffect(() => {
                if (mode && !winner && gameState === 'question') {
                    if (mode === 'single' && currentPlayer === 2) {
                        setTimeout(() => setGameState('choosing'), 800);
                    } else {
                        generateQuestion();
                    }
                }
            }, [mode, currentPlayer, gameState, winner]);

            useEffect(() => {
                if (mode === 'single' && currentPlayer === 2 && gameState === 'choosing' && !winner && !animCell) {
                    const timer = setTimeout(() => {
                        let available = [];
                        for(let c=0; c<7; c++) if(!board[0][c]) available.push(c);
                        if(available.length) {
                            const botCol = available[Math.floor(Math.random() * available.length)];
                            dropToken(botCol);
                        }
                    }, 1500);
                    return () => clearTimeout(timer);
                }
            }, [gameState, currentPlayer, mode, winner, animCell]);

            const generateQuestion = () => {
                const correct = words[Math.floor(Math.random() * words.length)];
                const others = words.filter(w => w.id !== correct.id).sort(() => 0.5 - Math.random()).slice(0, 2);
                setQuestion(correct);
                setOptions([...others, correct].sort(() => 0.5 - Math.random()));
            };

            const handleAnswer = (word) => {
                if (word.id === question.id) {
                    speak(word.eng);
                    setGameState('choosing');
                } else {
                    setCurrentPlayer(currentPlayer === 1 ? 2 : 1);
                    setGameState('question');
                }
                setQuestion(null);
            };

            const dropToken = async (col) => {
                if (gameState !== 'choosing' || winner || board[0][col] || animCell) return;
                
                let targetRow = -1;
                for (let r = 5; r >= 0; r--) {
                    if (!board[r][col]) {
                        targetRow = r;
                        break;
                    }
                }
                
                if (targetRow !== -1) {
                    setGameState('falling');
                    
                    // Progressive cell-by-cell animation
                    for (let r = 0; r <= targetRow; r++) {
                        setAnimCell({ row: r, col, player: currentPlayer });
                        await new Promise(res => setTimeout(res, 180)); // 180ms per cell
                    }

                    const newBoard = board.map(row => [...row]);
                    newBoard[targetRow][col] = currentPlayer;
                    setBoard(newBoard);
                    setAnimCell(null);
                    
                    const win = checkWinner(newBoard);
                    if (!win) {
                        setCurrentPlayer(currentPlayer === 1 ? 2 : 1);
                        setGameState('question');
                    }
                }
            };

            const checkWinner = (b) => {
                let found = null;
                for (let r = 0; r < 6; r++) for (let c = 0; c < 4; c++) if (b[r][c] && b[r][c] === b[r][c+1] && b[r][c] === b[r][c+2] && b[r][c] === b[r][c+3]) found = b[r][c];
                for (let r = 0; r < 3; r++) for (let c = 0; c < 7; c++) if (b[r][c] && b[r][c] === b[r+1][c] && b[r][c] === b[r+2][c] && b[r][c] === b[r+3][c]) found = b[r][c];
                for (let r = 3; r < 6; r++) for (let c = 0; c < 4; c++) if (b[r][c] && b[r][c] === b[r-1][c+1] && b[r][c] === b[r-2][c+2] && b[r][c] === b[r-3][c+3]) found = b[r][c];
                for (let r = 0; r < 3; r++) for (let c = 0; c < 4; c++) if (b[r][c] && b[r][c] === b[r+1][c+1] && b[r][c] === b[r+2][c+2] && b[r][c] === b[r+3][c+3]) found = b[r][c];
                if (found) setWinner(found);
                return found;
            };

            if (!mode) return (
                <div className="flex flex-col items-center justify-center space-y-4 h-96">
                    <h3 className="text-2xl font-black mb-4">×‘×—×¨ ××¦×‘ ××©×—×§:</h3>
                    <button onClick={() => setMode('single')} className={`w-full p-6 rounded-2xl border-4 font-black text-xl shadow-lg ${isDark ? 'bg-slate-800 border-slate-700 text-white' : 'bg-white border-sky-100 text-slate-800'}`}>×™×—×™×“ (× ×’×“ ×”××—×©×‘)</button>
                    <button onClick={() => setMode('multi')} className={`w-full p-6 rounded-2xl border-4 font-black text-xl shadow-lg ${isDark ? 'bg-slate-800 border-slate-700 text-white' : 'bg-white border-sky-100 text-slate-800'}`}>×–×•×’×•×ª (×–×” ××•×œ ×–×”)</button>
                    <button onClick={onBack} className="text-slate-400 font-bold mt-4">×‘×™×˜×•×œ</button>
                </div>
            );

            return (
                <div className="flex flex-col items-center w-full max-w-md mx-auto px-2 pb-10">
                    <div className="flex justify-between items-center w-full mb-4 px-4">
                        <h2 className="text-xl font-black italic">Connect 4 Magic</h2>
                        <button onClick={onBack} className="text-sky-500 font-bold p-1"><Icons.Back /></button>
                    </div>

                    {winner ? (
                        <div className={`text-center p-8 rounded-3xl shadow-2xl w-full border-4 flex flex-col items-center ${isDark ? 'bg-slate-900 border-yellow-500 text-white' : 'bg-white border-yellow-400 text-slate-800'}`}>
                            <Icons.Trophy />
                            <h2 className={`text-4xl font-black mt-4 ${winner === 1 ? 'text-red-500' : 'text-yellow-500'}`}>
                                {winner === 1 ? '×”×©×—×§×Ÿ ×”××“×•× × ×™×¦×—!' : mode === 'single' ? '×”××—×©×‘ × ×™×¦×—!' : '×”×©×—×§×Ÿ ×”×¦×”×•×‘ × ×™×¦×—!'}
                            </h2>
                            <button onClick={() => {setBoard(Array(6).fill(null).map(() => Array(7).fill(null))); setWinner(null); setCurrentPlayer(1); setGameState('question');}} className="w-full mt-6 bg-sky-500 text-white py-4 rounded-2xl font-bold shadow-lg">×©×—×§ ×©×•×‘</button>
                        </div>
                    ) : gameState === 'question' && question ? (
                        <div className={`w-full p-6 rounded-3xl shadow-xl border-4 text-center ${isDark ? 'bg-slate-900 border-sky-600' : 'bg-white border-sky-400'}`}>
                            <div className="flex justify-center items-center mb-6">
                                <h3 className={`text-4xl font-black english-text ${isDark ? 'text-sky-400' : 'text-sky-600'}`}>{question.eng}</h3>
                                <button onClick={() => speak(question.eng)} className={`mr-3 p-2 rounded-full ${isDark ? 'bg-slate-800 text-sky-400' : 'bg-sky-50 text-sky-500'}`}><Icons.Volume size={24}/></button>
                            </div>
                            <p className="mb-4 text-sm opacity-60 font-bold">×¢× ×” × ×›×•×Ÿ ×›×“×™ ×œ×”×¤×™×œ ××¡×™××•×Ÿ:</p>
                            <div className="grid grid-cols-1 gap-3">
                                {options.map(opt => (
                                    <button key={opt.id} onClick={() => handleAnswer(opt)} className={`p-4 rounded-xl border-2 font-black text-xl transition-all ${isDark ? 'bg-slate-800 border-slate-700 text-white hover:bg-slate-700' : 'bg-white border-sky-100 text-slate-800 hover:bg-sky-50'}`}>{opt.heb}</button>
                                ))}
                            </div>
                        </div>
                    ) : (
                        <div className="w-full flex flex-col items-center">
                            <div className={`text-center py-2 px-6 rounded-full mb-4 font-black transition-all transform shadow-md ${currentPlayer === 1 ? 'bg-red-500 text-white' : 'bg-yellow-400 text-slate-800'}`}>
                                {gameState === 'choosing' ? (currentPlayer === 1 ? '×‘×—×¨ ×¢××•×“×” ×œ×”×¤×œ×”!' : '×”××—×©×‘ ×‘×•×—×¨...') : '××•×¨×™×“ ××¡×™××•×Ÿ...'}
                            </div>
                            <div className="grid grid-cols-7 gap-1 w-full px-2 mb-2">
                                {[0,1,2,3,4,5,6].map(c => (
                                    <button 
                                        key={c}
                                        onClick={() => dropToken(c)} 
                                        disabled={gameState !== 'choosing' || !!board[0][c] || (mode === 'single' && currentPlayer === 2)}
                                        className={`flex flex-col items-center justify-center transition-all ${gameState !== 'choosing' || board[0][c] || (mode === 'single' && currentPlayer === 2) ? 'opacity-0' : 'opacity-100'}`}
                                    >
                                        <div className="animate-bounce-slow">
                                            <Icons.ArrowDown color={currentPlayer === 1 ? "#ef4444" : "#eab308"} />
                                        </div>
                                    </button>
                                ))}
                            </div>
                            <div className="grid-4-row w-full">
                                {board.map((row, r) => row.map((cell, c) => {
                                    const isAnimating = animCell && animCell.row === r && animCell.col === c;
                                    const player = isAnimating ? animCell.player : cell;
                                    return (
                                        <div 
                                            key={`${r}-${c}`} 
                                            onClick={() => dropToken(c)}
                                            className={`cell-4-row cursor-pointer ${
                                                player === 1 ? 'cell-active-red' : 
                                                player === 2 ? 'cell-active-yellow' : 
                                                (isDark ? 'bg-slate-950' : 'bg-slate-50')
                                            }`}
                                        ></div>
                                    );
                                }))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- Spelling Game ---
        const SpellingGame = ({ words, onBack, isDark }) => {
            const [idx, setIdx] = useState(0);
            const [input, setInput] = useState("");
            const [status, setStatus] = useState("playing");
            const [correctCount, setCorrectCount] = useState(0);
            const current = words[idx];

            useEffect(() => { if (current) speak(current.eng); }, [idx]);

            const check = (e) => {
                e.preventDefault();
                if (!input.trim() || status !== "playing") return;
                const isCorrect = input.toLowerCase().trim() === current.eng.toLowerCase().trim();
                if (isCorrect) { setCorrectCount(c => c + 1); setStatus("correct"); }
                else { setStatus("wrong"); }
                setTimeout(() => {
                    if (idx + 1 < words.length) { setIdx(idx + 1); setInput(""); setStatus("playing"); }
                    else { setStatus("finished"); fireConfetti(); }
                }, 1000);
            };

            if (status === "finished") return (
                <div className={`text-center p-8 rounded-[3rem] shadow-xl w-full max-w-sm mx-auto flex flex-col items-center border-4 ${isDark ? 'bg-slate-900 border-sky-500 text-white' : 'bg-white border-sky-400 text-slate-800'}`}>
                    <Icons.Trophy />
                    <h2 className="text-4xl font-black text-orange-500 mt-4 mb-2">×”×›×ª×‘×” ×”×¡×ª×™×™××”!</h2>
                    <p className={`text-2xl font-bold mb-8`}>×¦×™×•×Ÿ: {correctCount} ××ª×•×š {words.length}</p>
                    <button onClick={onBack} className="w-full bg-sky-500 text-white py-5 rounded-3xl font-black text-2xl shadow-lg btn-pushable border-sky-700">×—×–×¨×” ×œ×ª×¤×¨×™×˜</button>
                </div>
            );

            return (
                <div className="flex flex-col items-center space-y-4 w-full max-w-md mx-auto px-4">
                    <button onClick={onBack} className="self-start opacity-40 p-2"><Icons.Back /></button>
                    <div className={`w-full p-6 rounded-[2rem] text-center border-[5px] shadow-lg max-w-[300px] ${isDark ? 'bg-slate-900 border-slate-800' : 'bg-white border-orange-100'}`}>
                        <h3 className="text-3xl font-black text-orange-600">{current.heb}</h3>
                    </div>
                    <button onClick={() => speak(current.eng)} className="w-20 h-20 bg-orange-500 text-white rounded-full flex items-center justify-center shadow-md active:scale-95 transition-transform"><Icons.Volume size={32} /></button>
                    <form onSubmit={check} className="w-full">
                        <input 
                            type="text" value={input} onChange={(e) => setInput(e.target.value)} dir="ltr"
                            className={`english-text w-full p-4 rounded-3xl border-4 text-center text-3xl font-bold outline-none transition-all ${
                                status === 'correct' ? 'border-green-500 bg-green-50' : 
                                status === 'wrong' ? 'border-red-500 bg-red-50 animate-shake' : 
                                (isDark ? 'bg-slate-950 border-slate-700 text-white focus:border-sky-500' : 'bg-white border-sky-100 focus:border-sky-400 text-slate-800')
                            }`}
                            placeholder="..." autoComplete="off"
                        />
                        <button type="submit" className="w-full mt-4 bg-sky-500 text-white py-4 rounded-2xl font-black text-xl shadow-md btn-pushable border-sky-700">×‘×“×•×§</button>
                    </form>
                </div>
            );
        };

        // --- Flashcards ---
        const Flashcards = ({ words, onFinish, isDark }) => {
            const [queue, setQueue] = useState([...words]);
            const [idx, setIdx] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const current = queue[idx];

            const handleNext = (wellKnown) => {
                if (!wellKnown) setQueue([...queue, current]);
                if (idx + 1 < queue.length) { setIdx(idx + 1); setIsFlipped(false); }
                else onFinish();
            };

            return (
                <div className="flex flex-col items-center space-y-4 py-2 px-4 h-full">
                    <div className="w-full max-w-[280px] aspect-[4/5] perspective cursor-pointer" onClick={() => setIsFlipped(!isFlipped)}>
                        <div className={`relative w-full h-full preserve-3d transition-transform duration-500 rounded-[2.5rem] shadow-xl ${isFlipped ? 'rotate-y-180' : ''}`}>
                            <div className={`absolute inset-0 backface-hidden rounded-[2.5rem] border-[6px] flex flex-col items-center justify-center ${isDark ? 'bg-slate-900 border-sky-500 text-white' : 'bg-white border-sky-400 text-slate-800'}`}>
                                <h3 className="english-text text-4xl font-bold text-center px-4">{current.eng}</h3>
                                <button onClick={(e) => { e.stopPropagation(); speak(current.eng); }} className={`mt-6 p-4 rounded-full ${isDark ? 'bg-slate-800 text-sky-400' : 'bg-sky-50 text-sky-600'}`}><Icons.Volume size={24}/></button>
                                <p className="mt-8 text-xs font-bold opacity-30 animate-pulse">×œ×—×¦×• ×œ×¡×•×‘×‘ ××ª ×”×›×¨×˜×™×¡</p>
                            </div>
                            <div className={`absolute inset-0 backface-hidden rotate-y-180 rounded-[2.5rem] border-[6px] flex flex-col items-center justify-center text-white p-6 text-center ${isDark ? 'bg-sky-900 border-white' : 'bg-sky-600 border-white'}`}>
                                <h3 className="text-4xl font-black">{current.heb}</h3>
                                <p className="mt-8 text-xs font-bold opacity-60 animate-pulse">×œ×—×¦×• ×—×–×¨×”</p>
                            </div>
                        </div>
                    </div>
                    <div className="grid grid-cols-2 gap-4 w-full max-w-sm pt-2">
                        <button onClick={() => handleNext(false)} className="bg-red-50 text-red-700 p-4 rounded-2xl font-black border-b-4 border-red-200 active:translate-y-1">ğŸ‘ ×¢×•×“ ×œ×</button>
                        <button onClick={() => handleNext(true)} className="bg-green-50 text-green-700 p-4 rounded-2xl font-black border-b-4 border-green-200 active:translate-y-1">ğŸ‘ ×™×•×“×¢!</button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('setup');
            const [wordList, setWordList] = useState([]);
            const [isDark, setIsDark] = useState(false);

            const start = () => {
                const val = document.getElementById('words-input').value;
                const parsed = val.split('\n').map(l => {
                    const p = l.split(/[,\t\-:|]+/).map(i => i.trim());
                    return p.length >= 2 ? { eng: p[0], heb: p[1], id: Math.random().toString(36).substr(2,9) } : null;
                }).filter(Boolean);
                if (parsed.length >= 4) { setWordList(parsed); setView('learning'); }
            };

            return (
                <div className={`min-h-screen flex flex-col p-4 transition-colors duration-300 ${isDark ? 'bg-slate-950 text-white' : 'bg-sky-50 text-slate-900'}`}>
                    <header className="flex justify-between items-center h-14 mb-2 max-w-md mx-auto w-full">
                        <button onClick={() => setIsDark(!isDark)} className={`p-2 border-2 rounded-xl transition-colors ${isDark ? 'border-slate-800 text-sky-400' : 'border-sky-100 text-sky-500'}`}>{isDark ? <Icons.Sun/> : <Icons.Moon/>}</button>
                        <h1 className="text-2xl font-black text-sky-500 italic">English Magic</h1>
                        <div className="w-10"></div>
                    </header>

                    <main className="flex-grow max-w-md mx-auto w-full">
                        {view === 'setup' && (
                            <div className={`p-6 rounded-[2rem] shadow-xl flex flex-col space-y-4 ${isDark ? 'bg-slate-900' : 'bg-white'}`}>
                                <h2 className="text-xl font-black text-center text-sky-600">×”×›× ×¡ ×¨×©×™××ª ××™×œ×™×</h2>
                                <textarea id="words-input" className={`english-text w-full h-56 p-4 rounded-2xl border-2 outline-none font-bold text-xl ${isDark ? 'bg-slate-950 border-slate-700 text-white' : 'bg-sky-50 border-sky-100 text-slate-800'}`} dir="ltr" placeholder="Dog - ×›×œ×‘&#10;Cat - ×—×ª×•×œ"></textarea>
                                <button onClick={start} className="w-full bg-sky-500 text-white py-5 rounded-2xl font-black text-2xl btn-pushable border-sky-700 shadow-lg">×”×ª×—×œ ×œ×œ××•×“!</button>
                            </div>
                        )}

                        {view === 'learning' && <Flashcards words={wordList} onFinish={() => setView('exam')} isDark={isDark} />}
                        {view === 'exam' && <Exam words={wordList} onPass={() => { fireConfetti(); setView('games'); }} isDark={isDark} />}

                        {view === 'games' && (
                            <div className="flex flex-col space-y-4 py-2">
                                <div className="bg-green-500 text-white p-6 rounded-[2rem] text-center shadow-lg">
                                    <h2 className="text-2xl font-black italic">×›×œ ×”×›×‘×•×“! × ×¤×ª×— ×©×œ×‘ ×”××©×—×§×™×</h2>
                                </div>
                                <div className="grid grid-cols-1 gap-3">
                                    <button onClick={() => setView('memory')} className={`p-5 rounded-2xl font-black text-xl border-4 shadow-sm flex items-center justify-between ${isDark ? 'bg-slate-800 border-slate-700 text-white' : 'bg-white border-sky-100 text-slate-800'}`}>
                                        <span>××©×—×§ ×”×–×™×›×¨×•×Ÿ ğŸ§ </span>
                                    </button>
                                    <button onClick={() => setView('spelling')} className={`p-5 rounded-2xl font-black text-xl border-4 shadow-sm flex items-center justify-between ${isDark ? 'bg-slate-800 border-slate-700 text-white' : 'bg-white border-orange-100 text-slate-800'}`}>
                                        <span>×”×›×ª×‘×” âœï¸</span>
                                    </button>
                                    <button onClick={() => setView('connect4')} className={`p-5 rounded-2xl font-black text-xl border-4 shadow-sm flex items-center justify-between ${isDark ? 'bg-slate-800 border-slate-700 text-white' : 'bg-white border-blue-100 text-slate-800'}`}>
                                        <span>4 ×‘×©×•×¨×” ğŸ”´ğŸŸ¡</span>
                                    </button>
                                </div>
                                <button onClick={() => setView('setup')} className="text-slate-400 font-bold p-4 text-center mt-4">â† ×”×—×œ×£ ×¨×©×™××ª ××™×œ×™×</button>
                            </div>
                        )}

                        {view === 'memory' && <MemoryGame words={wordList} onBack={() => setView('games')} isDark={isDark} />}
                        {view === 'spelling' && <SpellingGame words={wordList} onBack={() => setView('games')} isDark={isDark} />}
                        {view === 'connect4' && <Connect4Game words={wordList} onBack={() => setView('games')} isDark={isDark} />}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

